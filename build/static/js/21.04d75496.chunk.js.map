{"version":3,"sources":["views/login/forgot-password/index.js","services/auth.js","services/failTokens.js","services/user.js","socket.js","assets/car_image.svg","../node_modules/antd/es/row/index.js","../node_modules/antd/es/col/index.js"],"names":["require","withNamespaces","t","useState","loading","setLoading","history","useHistory","className","style","height","minHeight","span","lg","name","initialValues","remember","onFinish","values","data","forgotPassword","res","status","console","log","notification","success","message","description","placement","duration","error","htmlFor","Item","rules","validator","_","value","Promise","resolve","placeholder","htmlType","onClick","push","axios","AxiosConfig","getAllowedRoute","routes","role","allowedData","forEach","route","permission","includes","getAllowedNav","navigation","nav","_children","child","index","splice","storeUserData","user","email","localStorage","setItem","process","JSON","stringify","getToken","callback","post","accessToken","getItem","refreshToken","then","catch","err","response","logOut","removeItem","window","location","href","getProfile","get","updateProfile","put","loginUser","verifyToken","token","updatePassword","patch","updateVerifyPassword","instance","Row","Col"],"mappings":"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","file":"static/js/21.04d75496.chunk.js","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { Link, useHistory } from \"react-router-dom\";\r\nimport {\r\n  Form,\r\n  Input,\r\n  Button,\r\n  Row,\r\n  Col,\r\n  Checkbox,\r\n  message,\r\n  Radio,\r\n  notification,\r\n} from \"antd\";\r\nimport car_image from \"src/assets/car_image.svg\";\r\nimport \"../Login.scss\";\r\nimport { Roles, Validate } from \"src/configs\";\r\nimport { withNamespaces } from \"react-i18next\";\r\nimport { forgotPassword } from \"src/services/user\";\r\n\r\nvar _ = require(\"lodash\");\r\n\r\nconst ForgotPassword = ({ t }) => {\r\n  const [loading, setLoading] = useState(false);\r\n  const history = useHistory();\r\n\r\n  const onFinish = (values) => {\r\n    const { remember, ...data } = values;\r\n    setLoading(true);\r\n    forgotPassword(data, (res) => {\r\n      if (res.status == 200) {\r\n        console.log(res);\r\n        notification.success({\r\n          message: t(`Notification`),\r\n          description: t(\r\n            `${\r\n              res?.data?.message ||\r\n              \"Send reset password confirmation email success succesfully\"\r\n            }`\r\n          ),\r\n          placement: `bottomRight`,\r\n          duration: 1.5,\r\n        });\r\n        setLoading(false);\r\n      }\r\n      if (res.status !== 200) {\r\n        console.log(res);\r\n        notification.error({\r\n          message: t(`Notification`),\r\n          description: t(\r\n            `${res.message || \"Send email for recover password failed\"}`\r\n          ),\r\n          placement: `bottomRight`,\r\n          duration: 1.5,\r\n        });\r\n        setLoading(false);\r\n      }\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className={\"login\"} style={{ height: \"100%\", minHeight: \"100%\" }}>\r\n      <Row span={24} className={\"login-container\"}>\r\n        <Col lg={12} className={\"left-side forgot-password\"}>\r\n          <h2>{t(\"Forgot Password\")}</h2>\r\n          <Form\r\n            name=\"normal_login\"\r\n            initialValues={{\r\n              remember: true,\r\n            }}\r\n            onFinish={onFinish}\r\n            className=\"position-relative\"\r\n          >\r\n            <label htmlFor=\"email\">{t(\"Email\")}</label>\r\n            <Form.Item\r\n              name=\"email\"\r\n              rules={[\r\n                {\r\n                  validator: (_, value) => {\r\n                    if (value) {\r\n                      return Promise.resolve();\r\n                    }\r\n                  },\r\n                },\r\n              ]}\r\n            >\r\n              <Input placeholder={t(\"Email\")} />\r\n            </Form.Item>\r\n            <Button htmlType=\"submit\" className=\"box-1\" loading={loading}>\r\n              {t(\"Confirm\")}\r\n            </Button>\r\n            <Button\r\n              htmlType=\"button\"\r\n              onClick={() => {\r\n                history.push(\"/login\");\r\n              }}\r\n              className=\"box-2\"\r\n              loading={loading}\r\n            >\r\n              {t(\"Login\")}\r\n            </Button>\r\n          </Form>\r\n        </Col>\r\n      </Row>\r\n      <div className={\"footer\"}>Uray</div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default withNamespaces()(ForgotPassword);\r\n","import { AxiosConfig } from \"src/configs\";\r\nimport { failTokens } from \"./failTokens\";\r\nimport sockets from \"src/socket\";\r\nconst axios = AxiosConfig();\r\n\r\nexport function isLoggedIn() {\r\n  return !!localStorage.getItem(`${process.env.REACT_APP_PREFIX_LOCAL}_user`);\r\n}\r\n\r\nexport function getAllowedRoute(routes, role) {\r\n  var allowedData = [];\r\n  routes.forEach((route) => {\r\n    if (route.permission) {\r\n      if (route.permission.includes(role)) {\r\n        allowedData.push(route);\r\n      }\r\n    } else {\r\n      allowedData.push(route);\r\n    }\r\n  });\r\n\r\n  return allowedData;\r\n}\r\n\r\nexport function getAllowedNav(navigation, role) {\r\n  var allowedData = [];\r\n  navigation.forEach((nav) => {\r\n    if (nav.permission) {\r\n      if (nav.permission.includes(role)) {\r\n        if (nav._children) {\r\n          nav._children.forEach((child, index) => {\r\n            if (child.permission && !child.permission.includes(role)) {\r\n              nav._children.splice(index, 1);\r\n            }\r\n          });\r\n        }\r\n\r\n        allowedData.push(nav);\r\n      }\r\n    } else {\r\n      if (nav._children) {\r\n        nav._children.forEach((child, index) => {\r\n          if (child.permission && !child.permission.includes(role)) {\r\n            nav._children.splice(index, 1);\r\n          }\r\n        });\r\n      }\r\n\r\n      allowedData.push(nav);\r\n    }\r\n  });\r\n\r\n  return allowedData;\r\n}\r\n\r\nexport function storeUserData(data) {\r\n  const user = {\r\n    email: data.email,\r\n    role: data.role,\r\n  };\r\n  localStorage.setItem(\r\n    `${process.env.REACT_APP_PREFIX_LOCAL}_user`,\r\n    JSON.stringify(user)\r\n  );\r\n}\r\n\r\nexport function getToken(callback) {\r\n  axios\r\n    .post(`${process.env.REACT_APP_API}auth/refresh-token`, {\r\n      accessToken: localStorage.getItem(\r\n        `${process.env.REACT_APP_PREFIX_LOCAL}_access_token`\r\n      ),\r\n      refreshToken: localStorage.getItem(\r\n        `${process.env.REACT_APP_PREFIX_LOCAL}_refresh_token`\r\n      ),\r\n    })\r\n    .then((res) => {\r\n      localStorage.setItem(\r\n        `${process.env.REACT_APP_PREFIX_LOCAL}_access_token`,\r\n        res.data.accessToken\r\n      );\r\n      localStorage.setItem(\r\n        `${process.env.REACT_APP_PREFIX_LOCAL}_refresh_token`,\r\n        res.data.refreshToken\r\n      );\r\n      callback();\r\n    })\r\n    .catch((err) => {\r\n      console.log(err);\r\n      if (err.response) {\r\n        if (failTokens().includes(err.response.status)) {\r\n          logOut();\r\n        }\r\n      }\r\n    });\r\n}\r\n\r\nexport async function getLazyToken() {\r\n  await axios\r\n    .post(`${process.env.REACT_APP_API}auth/refresh`, {\r\n      accessToken: localStorage.getItem(\r\n        `${process.env.REACT_APP_PREFIX_LOCAL}_access_token`\r\n      ),\r\n      refreshToken: localStorage.getItem(\r\n        `${process.env.REACT_APP_PREFIX_LOCAL}_refresh_token`\r\n      ),\r\n    })\r\n    .then((res) => {\r\n      localStorage.setItem(\r\n        `${process.env.REACT_APP_PREFIX_LOCAL}_access_token`,\r\n        res.data.data.access_token\r\n      );\r\n      localStorage.setItem(\r\n        `${process.env.REACT_APP_PREFIX_LOCAL}_refresh_token`,\r\n        res.data.data.refresh_token\r\n      );\r\n      // callback();\r\n    })\r\n    .catch((err) => {\r\n      if (err.response) {\r\n        if (failTokens().includes(err.response.status)) {\r\n          logOut();\r\n        }\r\n      }\r\n    });\r\n}\r\n\r\nexport function logOut() {\r\n  localStorage.removeItem(`${process.env.REACT_APP_PREFIX_LOCAL}_user`);\r\n  localStorage.removeItem(`${process.env.REACT_APP_PREFIX_LOCAL}_access_token`);\r\n  localStorage.removeItem(\r\n    `${process.env.REACT_APP_PREFIX_LOCAL}_refresh_token`\r\n  );\r\n  window.location.href = \"/login\";\r\n}\r\n","export const failTokens = () => {\r\n  return [401,403,400,404];\r\n}\r\n","import axios from \"axios\";\r\nimport { AxiosConfig } from \"src/configs\";\r\nimport { getToken } from \"./auth\";\r\n\r\n/**\r\n * 1 cách optimize cách viết này đó chính là tạo 1 hook là useAuth() nma lười quá nên tạm v\r\n */\r\n\r\nexport function getProfile(callback) {\r\n  const axiosConfig = AxiosConfig();\r\n\r\n  axiosConfig\r\n    .get(`${process.env.REACT_APP_API}account`)\r\n    .then((res) => {\r\n      callback(res);\r\n    })\r\n    .catch((err) => {\r\n      if (err.response) {\r\n        if (err.response.status === 403) {\r\n          getToken(() => {\r\n            getProfile(callback);\r\n          });\r\n        } else {\r\n          callback(err.response.data);\r\n        }\r\n      }\r\n    });\r\n}\r\n\r\nexport function updateProfile(data, callback) {\r\n  const axiosConfig = AxiosConfig();\r\n  axiosConfig\r\n    .put(`${process.env.REACT_APP_API}account/change/profile`, data)\r\n    .then((res) => {\r\n      callback(res);\r\n    })\r\n    .catch((err) => {\r\n      if (err.response) {\r\n        if (err.response.status === 403) {\r\n          getToken(() => {\r\n            updateProfile(data, callback);\r\n          });\r\n        } else {\r\n          callback(err.response.data);\r\n        }\r\n      }\r\n    });\r\n}\r\n\r\nexport function getListUsers(pagination, filter, sorter, callback) {\r\n  const axios = AxiosConfig();\r\n  let api = \"\";\r\n  if (Object.keys(filter).length === 0) {\r\n    api = `/user?page=${pagination.current}&size=${pagination.pageSize}`;\r\n  } else {\r\n    api = `/user?page=${pagination.current}&size=${pagination.pageSize}&${filter.filterStr}`;\r\n  }\r\n  axios\r\n    .get(api)\r\n    .then((res) => {\r\n      callback(res.data);\r\n    })\r\n    .catch((err) => {\r\n      if (err.response) {\r\n        if (err.response.status === 403) {\r\n          getToken(getListUsers(pagination, filter, sorter, callback));\r\n        } else {\r\n          callback(err.response.data);\r\n        }\r\n      }\r\n    });\r\n}\r\n\r\nexport function getUserDetails(user_id, callback) {\r\n  const axios = AxiosConfig();\r\n  axios\r\n    .get(`/user/detail/${user_id}`)\r\n    .then((res) => {\r\n      callback(res.data);\r\n    })\r\n    .catch((err) => {\r\n      if (err.response) {\r\n        if (err.response.status === 403) {\r\n          getToken(getUserDetails(user_id, callback));\r\n        } else {\r\n          callback(err.response.data);\r\n        }\r\n      }\r\n    });\r\n}\r\n\r\nexport function loginUser(data, callback) {\r\n  const axios = AxiosConfig();\r\n  console.log(data);\r\n  axios\r\n    .post(`${process.env.REACT_APP_API}auth/login`, data)\r\n    .then((res) => {\r\n      callback(res);\r\n    })\r\n    .catch((err) => {\r\n      if (err.response) {\r\n        callback(err.response.data);\r\n      }\r\n    });\r\n}\r\n\r\nexport function forgotPassword(data, callback) {\r\n  const axios = AxiosConfig();\r\n  axios\r\n    .post(`${process.env.REACT_APP_API}user/forgot-password`, data)\r\n    .then((res) => {\r\n      callback(res);\r\n    })\r\n    .catch((err) => {\r\n      if (err.response) {\r\n        callback(err.response.data);\r\n      }\r\n    });\r\n}\r\n\r\nexport const verifyToken = (token, callback) => {\r\n  const axios = AxiosConfig();\r\n  axios\r\n    .get(`${process.env.REACT_APP_API}user/forgot-password/verify/${token}`)\r\n    .then((res) => {\r\n      callback(res);\r\n    })\r\n    .catch((err) => {\r\n      if (err.response) {\r\n        callback(err.response.data);\r\n      }\r\n    });\r\n};\r\n\r\nexport const updatePassword = (data, callback) => {\r\n  const axiosConfig = AxiosConfig();\r\n  axiosConfig\r\n    .patch(`${process.env.REACT_APP_API}user/change/password`, data)\r\n    .then((res) => {\r\n      callback(res);\r\n    })\r\n    .catch((err) => {\r\n      if (err.response) {\r\n        if (err.response.status === 403) {\r\n          getToken(() => {\r\n            updatePassword(data, callback);\r\n          });\r\n        } else {\r\n          callback(err.response.data);\r\n        }\r\n      }\r\n    });\r\n};\r\n\r\nexport const updateVerifyPassword = (data, callback) => {\r\n  const axiosConfig = AxiosConfig();\r\n  axiosConfig\r\n    .post(\r\n      `${process.env.REACT_APP_API}user/forgot-password/updatePassword`,\r\n      data\r\n    )\r\n    .then((res) => {\r\n      callback(res);\r\n    })\r\n    .catch((err) => {\r\n      if (err.response) {\r\n        if (err.response.status === 403) {\r\n          getToken(() => {\r\n            updateVerifyPassword(data, callback);\r\n          });\r\n        } else {\r\n          callback(err.response.data);\r\n        }\r\n      }\r\n    });\r\n};\r\n","import { io } from \"socket.io-client\";\r\n\r\nconst URL = process.env.REACT_APP_SOCKET_API;\r\nconst sockets = (() => {\r\n  var instance;\r\n  return {\r\n    init: function (_id, role) {\r\n      instance = new io(URL, {\r\n        query: {\r\n          _id: _id,\r\n          role: role,\r\n        },\r\n      });\r\n      return instance;\r\n    },\r\n    getInstance: function (_id, role) {\r\n      if (!instance) this.init(_id, role);\r\n      return instance;\r\n    },\r\n    clearInstance: function () {\r\n      instance = null;\r\n    },\r\n  };\r\n})();\r\n\r\nexport default sockets;\r\n","export default __webpack_public_path__ + \"static/media/car_image.1db316ee.svg\";","import { Row } from '../grid';\nexport default Row;","import { Col } from '../grid';\nexport default Col;"],"sourceRoot":""}